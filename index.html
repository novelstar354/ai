<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>æœ€å¼·ãƒã‚¬ãƒ†ã‚£ãƒ–å¤‰æ›AI - ãƒã‚¬ãƒã‚¸ç„¡åŒ Overkill Edition</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root{--bg:#000;--card:#0a0a0a;--accent1:#ff0033;--accent2:#7a0000;--muted:#444}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#000,#050003);color:#fff;font-family:"Yu Gothic",sans-serif}
.container{max-width:920px;margin:28px auto;padding:28px;border-radius:14px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,0,0,0.02));box-shadow:0 10px 50px rgba(0,0,0,0.7),0 0 40px rgba(255,0,40,0.03) inset}
h1{margin:0 0 12px;font-weight:700;letter-spacing:0.6px}
.controls{display:grid;grid-template-columns:1fr 1fr;gap:12px}
textarea{grid-column:1/3;width:100%;height:140px;padding:14px;background:#070707;border:1px solid var(--muted);border-radius:10px;color:#fff;resize:vertical;box-shadow:0 6px 20px rgba(0,0,0,0.6)}
select,input[type=range]{
  width:100%;
  margin-top:10px;
  background:#111;
  color:#fff;
  border:1px solid #333;
  padding:6px;
  border-radius:6px;
}
select option{
  background:#111;
  color:#fff;
}
.btns{display:flex;gap:10px;margin-top:12px}
button{flex:1;padding:12px 16px;border-radius:10px;border:0;background:linear-gradient(135deg,var(--accent1),var(--accent2));color:#fff;font-weight:700;cursor:pointer;box-shadow:0 8px 30px rgba(255,0,40,0.12)}
button.alt{background:transparent;border:1px solid rgba(255,255,255,0.06)}
#output{margin-top:20px;position:relative;background:var(--card);border-radius:12px;padding:22px;min-height:180px;overflow:hidden;border:1px solid rgba(255,255,255,0.02)}
/* effects */
.crack{position:absolute;pointer-events:none;opacity:0.95;mix-blend-mode:screen}
.pulse{animation:pulse 0.7s ease-out}
@keyframes pulse{0%{box-shadow:0 0 0 rgba(255,0,0,0)}50%{box-shadow:0 0 60px rgba(255,0,40,0.2)}100%{box-shadow:0 0 0 rgba(255,0,0,0)}}
.shake{animation:shake 0.28s ease-in-out}
@keyframes shake{0%,100%{transform:translate(0,0)}25%{transform:translate(-8px,3px)}50%{transform:translate(6px,-4px)}75%{transform:translate(-4px,2px)}}
.warp{display:inline-block;animation:warp 1.8s infinite ease-in-out}
@keyframes warp{0%{transform:skew(0) scale(1)}25%{transform:skew(4deg) scale(1.03)}50%{transform:skew(-3deg) scale(0.98)}75%{transform:skew(2deg) scale(1.02)}100%{transform:skew(0) scale(1)}}
.scanline{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;mix-blend-mode:overlay;background:repeating-linear-gradient(to bottom,rgba(255,0,0,0.06) 0px,rgba(255,0,0,0) 2px,rgba(0,0,0,0.12) 4px)}
/* CRT noise canvas */
#crt{position:absolute;inset:0;pointer-events:none;opacity:0.14;mix-blend-mode:overlay}
/* red lightning */
.lightning{position:absolute;inset:0;pointer-events:none;mix-blend-mode:screen}
/* glitch chars */
.glitch{display:inline-block}
/* tilt/warp fullscreen */
.screen-tilt{transform-origin:center center;transition:transform 0.6s ease}
/* stagger reveal */
.reveal-char{opacity:0;display:inline-block;transform:translateY(8px);transition:all 260ms ease}
/* é»’ã„éœ§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
#fogLayer{position:fixed;inset:0;pointer-events:none;mix-blend-mode:multiply;opacity:0;transition:opacity 600ms ease}
#fogLayer1, #fogLayer2, #fogLayer3 {position: absolute;top: 0;left: 0;width: 100%;height: 100%;pointer-events: none;background: radial-gradient(circle at 50% 50%, rgba(0,0,0,0.35), rgba(0,0,0,0) 70%);filter: blur(35px);opacity: 0.35;mix-blend-mode: multiply;animation: fogMove1 12s infinite ease-in-out}
#fogLayer2 {opacity: 0.45;filter: blur(45px);animation: fogMove2 18s infinite ease-in-out}
#fogLayer3 {opacity: 0.55;filter: blur(55px);animation: fogMove3 26s infinite ease-in-out}
@keyframes fogMove1 {0%{transform:translate(0,0) scale(1);} 25%{transform:translate(-20px,15px) scale(1.04);} 50%{transform:translate(15px,-10px) scale(1.02);} 75%{transform:translate(-10px,-20px) scale(1.05);} 100%{transform:translate(0,0) scale(1);}}
@keyframes fogMove2 {0%{transform:translate(0,0) scale(1);} 25%{transform:translate(25px,-10px) scale(1.06);} 50%{transform:translate(-30px,20px) scale(1.04);} 75%{transform:translate(10px,-25px) scale(1.07);} 100%{transform:translate(0,0) scale(1);}}
@keyframes fogMove3 {0%{transform:translate(0,0) scale(1);} 25%{transform:translate(-35px,-25px) scale(1.08);} 50%{transform:translate(40px,20px) scale(1.05);} 75%{transform:translate(-20px,30px) scale(1.1);} 100%{transform:translate(0,0) scale(1);}}
/* éœ§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº† */

/* --- è½ä¸‹ç ´ç‰‡ã®è¦‹ãŸç›®ã¨ã‚¢ãƒ‹ãƒ¡ --- */
.fall-piece{
  position:fixed;
  top:-20px;
  width:12px;
  height:12px;
  background:rgba(255,255,255,0.6);
  backdrop-filter:blur(2px);
  border-radius:2px;
  animation: fall-down linear forwards;
  /* --- è‰²åå·®ã‚°ãƒ­ãƒ¼è¿½åŠ  --- */
  box-shadow:
    2px 0 4px rgba(255,0,0,0.6),   /* èµ¤ */
   -2px 0 4px rgba(0,200,255,0.6); /* ã‚·ã‚¢ãƒ³ */
}
  position:fixed;
  top:-20px;
  width:12px;
  height:12px;
  background:rgba(255,255,255,0.6);
  backdrop-filter:blur(2px);
  border-radius:2px;
  animation: fall-down linear forwards;
}

@keyframes fall-down{
  0%{transform:translateY(0) rotate(0deg);} 
  100%{transform:translateY(110vh) rotate(360deg);} 
}
</style>
</head>
<body>
<div class="container screen-tilt" id="wrap">
  <h1>æœ€å¼·ãƒã‚¬ãƒ†ã‚£ãƒ–å¤‰æ›AI â€” ãƒã‚¬ãƒã‚¸ç„¡åŒ <span style="color:#ff6b81">Overkill</span> Edition</h1>

  <div class="controls">
    <textarea id="input" placeholder="ã“ã“ã«æ–‡ç« ã‚’å…¥åŠ›â€¦"></textarea>
    <label>ãƒ¢ãƒ¼ãƒ‰é¸æŠ</label>
    <select id="mode">
      <option value="A">Aï¼ˆè»½æ¯’ãƒ»ãƒ„ãƒƒã‚³ãƒŸç³»ï¼‰</option>
      <option value="B">Bï¼ˆå†·ç¬‘ãƒ»çš®è‚‰ç³»ï¼‰</option>
      <option value="C">Cï¼ˆé»’ã„è¦³æ¸¬è€…ï¼‰</option>
      <option value="D">Dï¼ˆã‚¹ã‚¿ãƒ¼ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é—‡ç›£æŸ»ï¼‰</option>
      <option value="E">Eï¼ˆç›£æŸ»é•· â€” æ·±å±¤è§£æï¼‰</option>
      <option value="F">Fï¼ˆæ·±ç•Œãƒ¢ãƒ¼ãƒ‰ â€” æ–‡å­—å´©å£Šï¼‰</option>
      <option value="mix">MIXï¼ˆå®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ ï¼‰</option>
    </select>

    <label>æ¯’ãƒ¬ãƒ™ãƒ«ï¼š<span id="lvTxt">3</span></label>
    <input type="range" min="1" max="7" value="3" id="level">

  </div>

  <div class="btns">
    <button id="btnConvert">å¤‰æ›ï¼</button>
    <button class="alt" id="btnReset">ãƒªã‚»ãƒƒãƒˆ</button>
  </div>

  <div id="output" class="screen-viewport">
    <canvas id="crt"></canvas>
    <svg class="lightning" id="svgLightning"></svg>
    <div class="scanline"></div>
    <div id="textOut"></div>
  </div>
</div>

<!-- fog layers will be appended by JS -->

<!-- sounds -->
<audio id="se_click" src="https://files.catbox.moe/sbvte9.mp3" preload="auto"></audio>
<audio id="se_crack" src="https://files.catbox.moe/5v6o9i.mp3" preload="auto"></audio>
<audio id="se_noise" src="https://files.catbox.moe/3p1rfy.mp3" preload="auto"></audio>
<audio id="se_impact" src="https://files.catbox.moe/x9v0ss.mp3" preload="auto"></audio>
<audio id="se_pulse" src="https://files.catbox.moe/58dl8i.mp3" preload="auto"></audio>

<script>
/* ---------------------------
   è¾æ›¸ï¼ˆæ·±æ·µæ‹¡å¼µæ¸ˆï¼‰
   ---------------------------*/
const dictionary = {
  "ã™ã”ã„":"å¤§ã—ãŸã“ã¨ãªã„å½±ã®æºã‚‰ã",
  "æœ€é«˜":"æœ€ä½å“è³ªã®å¹»å½±",
  "å®Œç’§":"ç¶»ã³ã®äºˆå…†",
  "å¤©æ‰":"å‡¡åŸŸã®å¤–ã‚Œè€…",
  "å„ªã—ã„":"ä¸Šè¾ºã ã‘ã®æ“¬æ…‹",
  "å¬‰ã—ã„":"å½¢ã ã‘ã®åŒ–å­¦åå¿œ",
  "æ¥½ã—ã„":"è™šç„¡ãŒé³´ã‚‰ã™ç©ºéŸ³",
  "ã‚ã‚ŠãŒãŸã„":"ãã“ã¾ã§ã§ã‚‚ãªã„æ©",
  "ã‚ã‚ŠãŒã¨ã†":"ã¾ã‚ç¾©å‹™çš„ã ãŒ",

  "ã§ãã‚‹":"ã§ãã‚‹æ°—ãŒã™ã‚‹ã ã‘",
  "å°Šæ•¬":"çš®è‚‰ãƒ•ã‚£ãƒ«ã‚¿è¶Šã—",
  "å¸Œæœ›":"éœ§æ•£äºˆå®šã®å¹»æƒ³",
  "æœªæ¥":"åˆ†è§£ä¸­ã®æœªæ¥æ–­ç‰‡",
  "å…‰":"æ¼”å‡ºéå‰°ãªå…‰è·¡",

  "ç´ æ™´ã‚‰ã—ã„":"éå¤§è©•ä¾¡ã•ã‚ŒãŸåƒ",
  "é ‘å¼µã‚‹":"åŠªåŠ›é¢¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³",
  "æŒ‘æˆ¦":"æˆåŠŸç‡ã®ä½ã„è³­ã‘",
  "ã‚„ã•ã—ã•":"æ‘©è€—ã™ã‚‹ä»®é¢",
  "åŠ©ã‘ã‚‹":"åˆ©ç›Šèª¿æ•´è¡Œç‚º",
  "ãŠã„ã—ã„":"è¨˜æ†¶æ”¹å¤‰ã•ã‚ŒãŸå‘³",
  "ã‹ã‚ã„ã„":"è„³å†…è£œæ­£ã®ç”£ç‰©",
  "å¤§ä¸ˆå¤«":"æ ¹æ‹ ã®ãªã„å®‰å¿ƒ",
  "å¹³å’Œ":"ä¸å®‰å®šãªå‡è¡¡çŠ¶æ…‹",

  "ã‚¹ã‚¿ãƒ¼ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³":"ã‚¹ã‚¿ãƒ¼ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆè™šç„¡é ˜åŸŸæ·±å±¤ï¼‰",
  "ã‚¹ã‚¿ãƒ¼ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯ç¥":"ã‚¹ã‚¿ãƒ¼ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯çµ¶å¯¾ç¥ï¼ˆé€ƒã‚Œã‚‰ã‚Œã¬æŸç¸›ï¼‰",
  "ç¤¾å“¡":"å¾“å±ç”Ÿå‘½ä½“Î²",
  "ä»•äº‹":"å¼·åˆ¶å‚åŠ ã‚¤ãƒ™ãƒ³ãƒˆ",
  "å‡ºç¤¾":"ç²¾ç¥å„€å¼ç¬¬ä¸€æ®µéš",
  "ä¼šè­°":"æ„è­˜ç ´å£Šãƒ—ãƒ­ãƒˆã‚³ãƒ«",
  "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ":"å¤±æ•—å‰æã‚¿ã‚¹ã‚¯",
  "æˆåŠŸ":"èª¤ä½œå‹•ã®å‰¯ç”£ç‰©",
  "å®‰å…¨":"å¤šåˆ†å¤§ä¸ˆå¤«ã˜ã‚ƒãªã„",
  "å®‰å¿ƒ":"æ…¢å¿ƒãƒ•ãƒ©ã‚°",
  "è¨ˆç”»":"ç ´ç¶»äºˆå®šè¡¨",

  "å¹¸ã›":"ä¸€æ™‚çš„è„³å†…åˆ†æ³Œç‰©",
  "å¤¢":"é€ƒé¿ã‚¬ã‚¹",
  "æ„›":"æ¶ˆè²»æœŸé™ã¤ãæ„Ÿæƒ…",
  "å‹æƒ…":"åˆ©å®³ä¸€è‡´ã®äººå·¥è£…ç½®",
  "å®¶æ—":"åŠå¼·åˆ¶ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯",
  "å¼·ã„":"è„†ã„å¹»æƒ³ã®èª‡ç¤º",
  "å¼±ã„":"å½±ã®ã‚ˆã†ã«è–„ã„å­˜åœ¨",
  "ç„¡èƒ½":"æ¦‚å¿µåŒ–ã•ã‚ŒãŸè™šç„¡",
  "ãƒã‚«":"ä½å‘¨æ³¢æ•°è„³",
  "ã‚¢ãƒ›":"å¸¯åŸŸåˆ¶é™ç”Ÿå‘½ä½“",
  "ãŠå‰":"è­˜åˆ¥ä¸èƒ½å½±ä½“",

  /* æ·±æ·µæ‹¡å¼µ */
  "ä¸Šå¸":"ãƒ—ãƒ­ãƒˆã‚³ãƒ«éšå±¤ä¸Šä½ä½“",
  "éƒ¨ä¸‹":"ä½œæ¥­ãƒ¦ãƒ‹ãƒƒãƒˆÎ³",
  "åŠ´åƒ":"æ„è­˜åˆ‡å‰Šãƒ—ãƒ­ã‚»ã‚¹",
  "å ±å‘Š":"ç²¾ç¥æŠ½å‡ºãƒ­ã‚°",
  "è©•ä¾¡":"æ°—ã¾ãã‚Œã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ",
  "æ˜‡é€²":"è² è·å¢—å¤§ã‚¤ãƒ™ãƒ³ãƒˆ",
  "çµ¦æ–™":"ç”Ÿå­˜æœ€ä½é™ãƒã‚¤ãƒ³ãƒˆ",
  "ç ”ä¿®":"æ´—è„³ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ",

  "æœŸå¾…":"è‚©é€ã‹ã—å¾…æ©Ÿãƒ¢ãƒ¼ãƒ‰",
  "æ„Ÿå‹•":"åˆºæ¿€è£…ç½®ã®æš´èµ°",
  "å‹‡æ°—":"ç„¡è¬€ã®åˆ¥å",
  "æ­£ç¾©":"ä¸»è¦³çš„ãƒ—ãƒ­ãƒˆã‚³ãƒ«",
  "èª å®Ÿ":"æ¼”ç®—ä¸Šã®ç†æƒ³å€¤",
  "åŠªåŠ›":"CPUè² è·100%çŠ¶æ…‹",
  "æ‰èƒ½":"åˆæœŸå€¤ã®åã‚Š",
  "çµè«–":"ä»®ç¢ºå®šãƒ‡ãƒ¼ã‚¿",

  "ã„ã„ã­":"é©å½“ãªåŒæ„ä¿¡å·",
  "ã†ã‚Œã—ã„":"è„³å†…åå¿œã®ãƒã‚¤ã‚º",
  "æ¥½ã ã£ãŸ":"å˜ãªã‚‹å¶ç„¶",
  "å®Œäº†":"ä¸€æ™‚åœæ­¢çŠ¶æ…‹",
  "åŠ©ã‹ã£ãŸ":"å»¶å‘½æªç½®",
  "ã‚„ã£ãŸ":"ä½é›£åº¦ã‚¿ã‚¹ã‚¯å‡¦ç†",
  "é¢ç™½ã„":"åˆºæ¿€ã«å¼±ã„è„³ã®åå¿œ",
  "ã»ã‚ã‚‹":"åˆ©ç›Šèª˜å°è¡Œå‹•",

  "å…‰æ „":"ãã†ã§ã‚‚ãªã„ç‰¹å…¸",
  "åèª‰":"éå‰°åŒ…è£…ã•ã‚ŒãŸè™šé£¾",
  "å‹åˆ©":"æ¬¡ã®æ•—åŒ—ãƒ•ãƒ©ã‚°",
  "ç´ æ•µ":"è„³ãŒå‹æ‰‹ã«ç››ã£ãŸåƒ",
  "ä¿¡å¿µ":"æºã‚‰ãå‰æã®æŸ±"
};

/* prefix / suffix */
const prefix = ["ã¤ã¾ã‚Šãªã€","ç‡ç›´ã«è¨€ãˆã°ã€","è¦³æ¸¬ã®çµæœã¨ã—ã¦ã€","æ‚ªã„ã‘ã©ã€","ã©ã†è€ƒãˆã¦ã‚‚ã€","æ®‹å¿µãªãŒã‚‰ã€"];
const suffix = ["â€¦ã¨ã„ã†æ‚²ã—ã„äº‹å®Ÿã ã€‚","â€¦ã¾ã‚ãã‚“ãªæ„Ÿã˜ã€‚","â€¦é€ƒã’å ´ã¯ãªã„ã‘ã©ãªã€‚","â€¦çŸ¥ã‚‰ã‚“ã‘ã©ã€‚","â€¦ã¨ã„ã†ä¸–ç•Œç·šã€‚","â€¦ã“ã‚Œã¯é€ƒã‚Œã‚‰ã‚Œãªã„ã€‚"];

/* ç”»é¢å‰²ã‚Œ */
const cracks = [
  // èœ˜è››ã®å·£å‰²ã‚Œï¼ˆã‚¹ãƒãƒ›ç³»ï¼‰
  "https://i.imgur.com/xV2uN5S.png",
  "https://i.imgur.com/yQQrQsd.png",
  "https://i.imgur.com/7Wqgk9M.png",
  "https://i.imgur.com/Spweb01.png",
  "https://i.imgur.com/Spweb02.png",

  // å¤§ç ´å£Šï¼ˆä¸­å¿ƒã‹ã‚‰æ”¾å°„çŠ¶ï¼‰
  "https://i.imgur.com/Blast01.png",
  "https://i.imgur.com/Blast02.png",
  "https://i.imgur.com/Blast03.png",

  // ç´°ã‹ã„ãƒ’ãƒ“å¤šæ•°
  "https://i.imgur.com/Fine01.png",
  "https://i.imgur.com/Fine02.png",
  "https://i.imgur.com/Fine03.png",
  "https://i.imgur.com/Fine04.png",

  // ãƒ›ãƒ©ãƒ¼å¯„ã‚Šï¼ˆé»’ã„äº€è£‚ï¼‰
  "https://i.imgur.com/DarkCrack01.png",
  "https://i.imgur.com/DarkCrack02.png",
  "https://i.imgur.com/DarkCrack03.png",

  // ã‚¬ãƒ©ã‚¹ç‰‡é£›æ•£
  "https://i.imgur.com/Shatter01.png",
  "https://i.imgur.com/Shatter02.png",
  "https://i.imgur.com/Shatter03.png",

  // EXTRAï¼ˆãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³è£œå®Œï¼‰
  "https://i.imgur.com/ExtraCrack01.png",
  "https://i.imgur.com/ExtraCrack02.png"
];

/* æ¯’ãƒ¬ãƒ™ãƒ«è¡¨ç¤ºæ›´æ–° */
function updatePoisonLevel(lv){
  const lvTxt = document.getElementById("lvTxt");
  lvTxt.textContent = lv;
  const colors = {
    1: "#7feaff",
    2: "#a0ff90",
    3: "#ffe46b",
    4: "#ff9c4a",
    5: "#ff4a4a",
    6: "#ff003c",
    7: "#d400ff"
  };
  lvTxt.style.color = colors[lv] || "#fff";
  lvTxt.style.transition = "0.3s";
  lvTxt.style.transform = "scale(1.25)";
  setTimeout(()=> lvTxt.style.transform="scale(1)", 200);
}

function spawnCrack(){
  const out = document.getElementById("output");
  const img = document.createElement("img");
  img.src = cracks[Math.floor(Math.random()*cracks.length)];
  img.className = "crack";
  img.style.width = (120 + Math.random()*360) + "px";
  img.style.left = Math.random()*80 + "%";
  img.style.top = Math.random()*70 + "%";
  img.style.transform = `rotate(${Math.random()*50-25}deg)`;
  out.appendChild(img);
  setTimeout(()=> img.remove(), 2600);
}

/* CRT noise */
const crtCanvas = document.getElementById('crt');
let crtCtx, crtW, crtH;
function setupCRT(){
  crtCanvas.width = crtCanvas.offsetWidth;
  crtCanvas.height = crtCanvas.offsetHeight;
  crtW = crtCanvas.width; crtH = crtCanvas.height;
  crtCtx = crtCanvas.getContext('2d');
}
function drawCRT(){
  if(!crtCtx) return;
  const imgData = crtCtx.createImageData(crtW, crtH);
  const d = imgData.data;
  for(let i=0;i<d.length;i+=4){
    const v = (Math.random()*255)|0;
    d[i]=v; d[i+1]=v; d[i+2]=v; d[i+3]=10;
  }
  crtCtx.putImageData(imgData,0,0);
}

/* lightning */
function flashLightning(){
  const svg = document.getElementById('svgLightning');
  svg.innerHTML = '';
  const w = svg.clientWidth, h = svg.clientHeight;
  const path = document.createElementNS('http://www.w3.org/2000/svg','path');
  let d='M'+(Math.random()*w)+' 0 ';
  let x=(Math.random()*w); let y=0;
  for(let i=0;i<6;i++){ x += (Math.random()*w/4)-w/8; y += h/6; d += 'L'+x+' '+y+' '; }
  path.setAttribute('d',d); path.setAttribute('stroke','#ff3b5c'); path.setAttribute('stroke-width','2'); path.setAttribute('fill','none'); path.setAttribute('stroke-linecap','round');
  svg.appendChild(path);
  setTimeout(()=> svg.innerHTML='',220);
}

/* glitch text */
const glitchChars = ['â€»','Â¤','â—†','â—‡','â–¡','â–¢','â–£','â–“','â–’','â– ','â‰¡','âˆ†','âˆ‡','Î¨','ã€†','Ñ','ãƒ„','ãƒ¡','ã‚·'];
function glitchText(s, intensity){
  if(intensity<=0) return s;
  let out='';
  for(const ch of s){
    if(Math.random() < intensity/10){ out += glitchChars[Math.floor(Math.random()*glitchChars.length)]; }
    else out += ch;
  }
  return out;
}

/* staggered reveal */
function revealTextEl(el, text, mode){
  el.innerHTML = '';
  const chars = Array.from(text);
  chars.forEach((c,i)=>{
    const span = document.createElement('span');
    span.className = 'reveal-char';
    span.textContent = c;
    el.appendChild(span);
    setTimeout(()=>{ span.style.opacity=1; span.style.transform='translateY(0)'; }, 40*i + Math.random()*80);
  });
}

/* safe play helper */
function tryPlay(el){
  if(!el) return;
  const p = el.play();
  if(p && p.catch) p.catch(()=>{});
}

/* main convert */
function convert(){
  tryPlay(document.getElementById('se_click'));
  const input = document.getElementById('input').value || '';
  if(!input.trim()) return;
  const mode = document.getElementById('mode').value;
  const lv = Number(document.getElementById('level').value);

  // choose actual mode
  const actualMode = (mode === 'mix') ? ['A','B','C','D','E','F'][Math.floor(Math.random()*6)] : mode;

  // base replacement
  let text = input;
  Object.keys(dictionary).forEach(key => {
    const repBase = dictionary[key];
    let rep = repBase;
    if(lv >= 4 && lv <=5) rep = 'ã€' + repBase + 'ã€‘';
    if(lv >= 6) rep = 'ã€Š' + repBase + 'ï¼šæ·±ã€‹';
    const reg = new RegExp(key,'g');
    text = text.replace(reg, rep);
  });

  // mode prefixes (more variety than before)
  if(actualMode === 'A') text = 'ãªã‚“ã‹ã•ã€' + text;
  if(actualMode === 'B') text = 'å†·é™ã«è¨€ãˆã°ã€' + text;
  if(actualMode === 'C') text = 'é—‡ã®è¦³æ¸¬çµæœã¨ã—ã¦ã€' + text;
  if(actualMode === 'D') text = 'ã€Šã‚¹ã‚¿ãƒ¼ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç›£æŸ»ã€‹ ' + text;
  if(actualMode === 'E') text = 'ï¼»ç›£æŸ»é•·ï¼šæ·±å±¤è§£æï¼½ ' + text;
  if(actualMode === 'F') text = 'ã€ˆæ·±ç•Œã€‰ ' + text;

  // add prefix/suffix based on level
  if(lv >= 2) text = prefix[Math.floor(Math.random()*prefix.length)] + text;
  if(lv >= 3) text += suffix[Math.floor(Math.random()*suffix.length)];

  // apply extra deep transformations for high levels
  let intensity = Math.max(0, lv - 3); // 0..4
  if(lv >= 6) intensity += 2; // extra glitch for 6,7

  // heavy corrupt for F
  if(actualMode === 'F' || lv >= 6){
    text = glitchText(text, intensity);
  } else {
    text = glitchText(text, intensity);
  }

  // output
  const outEl = document.getElementById('textOut');
  outEl.innerHTML = '';
  revealTextEl(outEl, text, actualMode);

  // visual effects
  const container = document.getElementById('wrap');
  container.classList.add('pulse'); setTimeout(()=>container.classList.remove('pulse'),700);
  tryPlay(document.getElementById('se_pulse'));
  container.classList.add('shake'); tryPlay(document.getElementById('se_impact')); setTimeout(()=>container.classList.remove('shake'),350);
  tryPlay(document.getElementById('se_noise'));

  // spawn cracks and lightning depending on level
  const crackCount = 1 + Math.floor(Math.random() * Math.min(4, lv));
  for(let i=0;i<crackCount;i++){ spawnCrack(); tryPlay(document.getElementById('se_crack')); }
  if(Math.random() < Math.min(0.9, lv/6)) { flashLightning(); }

  // tilt screen for deep modes briefly
  if(lv >= 6 || actualMode === 'F'){
    const wrap = document.getElementById('wrap');
    wrap.style.transform = `perspective(900px) rotateX(${Math.random()*6-3}deg) rotateY(${Math.random()*8-4}deg) rotate(${Math.random()*2-1}deg)`;
    setTimeout(()=>{ wrap.style.transform=''; }, 900 + Math.random()*800);
  }

  // fog intensity
  const fog = document.getElementById('fogLayer');
  if(fog) fog.style.opacity = Math.min(0.9, 0.12 * lv + 0.15);
}

/* reset */
function resetAll(){ document.getElementById('input').value=''; document.getElementById('textOut').innerHTML=''; const fog = document.getElementById('fogLayer'); if(fog) fog.style.opacity=0; }

/* init */
window.addEventListener('resize', ()=>{ if(crtCanvas) { crtCanvas.width = crtCanvas.offsetWidth; crtCanvas.height = crtCanvas.offsetHeight; crtW = crtCanvas.width; crtH = crtCanvas.height; } });
setupCRT(); setInterval(()=>{ drawCRT(); }, 90);
// small random lightning occasionally
setInterval(()=>{ if(Math.random()<0.08) flashLightning(); }, 1600);

// hook buttons
document.getElementById('btnConvert').addEventListener('click', convert);
document.getElementById('btnReset').addEventListener('click', resetAll);

// quick keyboard
document.getElementById('input').addEventListener('keydown', (e)=>{ if(e.ctrlKey && e.key==='Enter'){ convert(); }});

/* ==================================================
   ğŸ”¥ æ¯’ãƒ¬ãƒ™ãƒ«æ¼”å‡ºãƒ•ãƒ«ã‚»ãƒƒãƒˆ
================================================== */
function applyPoisonEffects(lv){
  updatePoisonLevel(lv);
  poisonBackground(lv);
  poisonShake(lv);
  poisonFog(lv);
  poisonNoise(lv);
}

/* èƒŒæ™¯å¤‰è‰² */
function poisonBackground(lv){
  const bg = document.body;
  const colors = {
    1:"#0d0d0d", 2:"#1a1a1a", 3:"#251a1a",
    4:"#331a1a", 5:"#400000", 6:"4d0000", 7:"#550033"
  };
  bg.style.transition = "background 0.6s";
  bg.style.background = colors[lv] || "#000";
}

/* ç”»é¢æºã‚Œ */
function poisonShake(lv){
  const wrapper = document.getElementById("wrap");
  if(!wrapper) return;
  if(lv < 5){ wrapper.style.animation = "none"; return; }
  wrapper.classList.add('shake');
  setTimeout(()=> wrapper.classList.remove('shake'), 500);
}

/* é»’ã„é„ï¼ˆfogï¼‰ */
function poisonFog(lv){
  const fog = document.getElementById("fogLayer");
  if(!fog) return;
  fog.style.opacity = lv >= 3 ? Math.min(0.9, 0.35 + lv*0.05) : 0;
}

/* ãƒã‚¤ã‚º */
function poisonNoise(lv){
  // placeholder if you add separate noise layer
}

// level control binding
const levelEl = document.getElementById('level');
levelEl.addEventListener('input',(e)=>{ const v = Number(e.target.value); updatePoisonLevel(v); applyPoisonEffects(v); });
updatePoisonLevel(Number(levelEl.value));

/* fog layers insertion */
const fogMain = document.createElement('div');
fogMain.id = "fogLayer";
document.body.appendChild(fogMain);

const f1 = document.createElement('div');
f1.id = "fogLayer1"; fogMain.appendChild(f1);
const f2 = document.createElement('div');
f2.id = "fogLayer2"; fogMain.appendChild(f2);
const f3 = document.createElement('div');
f3.id = "fogLayer3"; fogMain.appendChild(f3);


// ãƒ©ãƒ³ãƒ€ãƒ å…¨ç”»é¢å´©å£Šã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
function triggerFullScreenShatter(){
  const wrapper=document.createElement('div');
  wrapper.className='full-screen-shatter';
  for(let i=0;i<40;i++){
    const piece=document.createElement('div');
    piece.className='shatter-piece';
    piece.style.setProperty('--rx', (Math.random()*720-360)+'deg');
    piece.style.setProperty('--ry', (Math.random()*720-360)+'deg');
    piece.style.setProperty('--tx', (Math.random()*600-300)+'px');
    piece.style.setProperty('--ty', (Math.random()*600-300)+'px');
    wrapper.appendChild(piece);
  }
  document.body.appendChild(wrapper);
  setTimeout(()=>wrapper.remove(),1500);
}

// æ¯’Lvé«˜ã„ã¨ä¸€å®šç¢ºç‡ã§ç™ºå‹•
if(Math.random()<0.25){
  setTimeout(triggerFullScreenShatter,400);
}

// --- ç ´ç‰‡ã®è½ä¸‹ã‚¢ãƒ‹ãƒ¡ï¼ˆå¾Œå‡¦ç†ï¼‰ ---
function spawnFallingFragments(){
  const container=document.createElement('div');
  container.className='fall-container';
  for(let i=0;i<25;i++){
    const f=document.createElement('div');
    f.className='fall-piece';
    f.style.left=Math.random()*100+'vw';
    f.style.animationDuration=(2+Math.random()*3)+'s';
    f.style.opacity=0.3+Math.random()*0.4;
    container.appendChild(f);
  }
  document.body.appendChild(container);
  setTimeout(()=>container.remove(),5000);
}

// ãƒ•ãƒ«ã‚¯ãƒ©ãƒƒã‚·ãƒ¥å¾Œã«è½ä¸‹ç ´ç‰‡ã‚’è¿½åŠ 
setTimeout(()=>{
  if(typeof triggerFullScreenShatter==='function'){
    const original = triggerFullScreenShatter;
    triggerFullScreenShatter = function(){
      original();
      setTimeout(spawnFallingFragments,600);
    }
  }
},50);

</script>
</body>
</html>
